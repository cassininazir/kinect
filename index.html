<!DOCTYPE html>
<html>

<head>
  <title>User Radar</title>
   <script src="js/jquery-2.1.0.min.js"></script>
  <!--<script src="//code.jquery.com/jquery-1.7.2.min.js"></script> -->
  <script src='js/zig.min.js'></script>
  <script>
        // kinect
        function loaded() {
          var u = 0;
          var radardiv = document.getElementById('radar');
          var radar = {
            onuserfound: function (user) {
              var userdiv = $("#radar").append("div").addClass("user");
              //var userdiv = document.createElement('div');
              //userdiv.className = 'user';
              user.radarelement = userdiv; // add the radarelement property to the user object
              radardiv.appendChild(user.radarelement);
              u++; //increment each time new user is found
              $("#radar div").attr("id",function() {
                return "u" + u;
              });
              // lets display how many users we have
              $("#total span").html(u);
              // get thoughts via json file
              $.ajax({
                //url: 'data.json',
                url: 'http://selfvsother.com/json.php',
                dataType: 'json',
                type: 'GET',
                success: function(json) {
                  for (var i = 0; i < json.length; i++) {
                    console.log(json[(u-1)].thoughttext);
                    var thought = json[(u-1)].thoughttex
                  };
                  var wrapper = "<li class='single-feed'>";
                  $("#blur").append($(wrapper).append(thought));
                },
                error: function () {
                  alert("I am sorry, But I can't fetch that feed");
                }
              });
            },
            onuserlost: function (user) {
              radardiv.removeChild(user.radarelement);
            },
            ondataupdate: function (zigdata) {
              for (var userid in zigdata.users) {
                var user = zigdata.users[userid];
                var pos = user.position;
                var el = user.radarelement;
                var parentElement = el.parentNode;
                var zrange = 4000;
                var xrange = 4000;
                var pixelwidth = parentElement.offsetWidth;
                var pixelheight = parentElement.offsetHeight;
                var heightscale = pixelheight / zrange;
                var widthscale = pixelwidth / xrange;
                el.style.left = (((pos[0] / xrange) + 0.5) * pixelwidth - (el.offsetWidth / 2)) + "px";
                el.style.top = ((pos[2] / zrange) * pixelheight - (el.offsetHeight / 2)) + "px";
              }
            }
          };
          zig.addListener(radar);
        }
        document.addEventListener('DOMContentLoaded', loaded, false);


        // end document.ready function
  //    });
  </script>
  <link rel="stylesheet" href="css/styles.css">

</head>

<body>
  <div id='radar'></div>
  <div id="blur">
    <!--<img src="img/blur.jpg" style="">-->
  </div>
  <footer>
    <p id="total"><span>0</span> total users</p>
  </footer>
</body>

</html>
